<div class="container contentPage">

	{% include themes/twitter/title-page.html %}

	<div class="row lineVertical">
		<div class="span2">&nbsp;</div>
		<div class="span10">&nbsp;</div>
	</div>

	<div class="row-fluid innerContentPage">
		<div class="span12">
			<div class="span2">
				{% include themes/twitter/blog/blog-menu.html %}
			</div>
			<div class="span10">
				<ul class="blog-posts" id="search-results"></ul>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">

	var majusculeFirst = function(str) {
	  var temp = str.charAt(0).toUpperCase();
	  for (var i = 1; i < str.length; i++) {
	    temp += str.charAt(i).toLowerCase();
	  }
	  return temp;
	}

	var getParam = function(param) {
	  var queryString = window.location.search.substring(1),
	      queries = queryString.split("&");
	  for (var i in queries) {
	    var pair = queries[i].split("=");
	    if (pair[0] == param) {
	      return pair[1];
	    }
	  }
	  return null;
	};

	var filterPostsByPropertyValue = function(posts, property, value) {
	  console.log("filterPostsByPropertyValue, property = " + property + '; value = ' + value);
	  var filteredPosts = [];
	  posts.pop();
	  for (var i in posts) {
	    var post = posts[i],
	        prop = post[property];
	    
	    post.tags.pop();
	    
	    if (prop.constructor == String) {
	      if (prop.toLowerCase() == value.toLowerCase()) {
	        filteredPosts.push(post);
	      }
	    } else if (prop.constructor == Array) {
	      for (var j in prop) {
	        if (prop[j].toLowerCase() == value.toLowerCase()) {
	          filteredPosts.push(post);
	        }
	      }
	    }
	  }
	  
	  return filteredPosts;
	};

	var layoutResultsPage = function(property, value, posts) {
	  console.log('start function layoutResultsPage()');
	  var $container = $('#search-results');
	  if ($container.length == 0) return;
	  
	  
	  for (var i in posts) {
	    var tagsList = '',
	        post     = posts[i],
	        tags     = post.tags,
	        queryString = window.location.search.substring(1),
	        iconClass;

	    iconClass = post.category.toLowerCase() == 'engineering' ? 'icon-cog' : 'icon-globe';

	    for (var j in tags) {
	      tagsList +=  tags[j].toLowerCase() ;
	    }
	    
	    $container.append(
			'<li class="blog-post">'
	      	+ '<h3><a href="'
	      	+ post.href
	      	+ '?'
	      	+ queryString
	      	+ '">'
	      	+ post.title
	      	+ '</a></h3>'
	      	+ '<div class="post-header">'
			+ '<span class="author">'
			+ '<a href="'
			+ post.author_url
			+ '">'
			+ post.by
			+ '</a>'
			+ '</span>'
			+ '<span class="date"><i class="icon-time">&nbsp;</i>'
			+ post.date
			+ '</span>'
			+ '<span class="category"><i class="'
			+ iconClass
			+ '">&nbsp;</i>'
			+ post.category
			+ '</span>'
			+ '</div>'
			+ '<p>'
			+ post.excerpt
			+ '</p>'
			+ '<a class="standart-btn" href="'
	      	+ post.href
	      	+ '?'
	      	+ queryString
	      	+ '">Read More...</a>'
	        + '</li>'
	    );
	  }
	}

	var noResultsPage = function(property, value) {
	  console.log('start function noResultPage()');
	  var $container = $('#search-results');
	  if ($container.length == 0) return;
	  
	  $container.find('h1').text('No Results Found.').after('<p class="nadda"></p>');
	  
	  var txt = "We couldn't find anything associated with '" + value + "' here.";
	  $container.find('p.nadda').text(txt);
	};

	var highlightMenuItem = function(type, value) {
		var list = $('[name="' + type +'"]'),
			listItem;
		list.find('li').removeClass('active');
		listItem = list.find('[name="' + value +'"]');
		listItem.addClass('active');

	};

	$(function() {
	  var map = {
	    'category' : getParam('category'),
	    'tags' : getParam('tag'),
	    'archive' : getParam('date')
	  };

	  $.each(map, function(type, value) {
	    if (value !== null) {
	      highlightMenuItem(type, value);
	      $.getJSON('/search.json', function(data) {
	        posts = filterPostsByPropertyValue(data, type, value);
	        if (posts.length === 0) {
	          noResultsPage(type, value);
	        } else {
	          layoutResultsPage(type, value, posts);
	        }
	      });
	    }
	  });

	});

</script>